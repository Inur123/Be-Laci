// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
  engineType = "binary"
}

datasource db {
  provider = "postgresql"
}

enum Role {
  SEKRETARIS_PAC
  SEKRETARIS_CABANG
}

enum JenisSurat {
  MASUK
  KELUAR
}

enum Organisasi {
  IPNU
  IPPNU
  BERSAMA
}

model User {
  id            String   @id @default(uuid())
  name          String
  email         String   @unique
  passwordHash  String
  role          Role
  isActive      Boolean  @default(true)
  tokenVersion  Int      @default(0)
  emailVerified DateTime?
  emailVerifyTokenHash String?
  emailVerifyExpiresAt DateTime?
  image         String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
  periodes      Periode[]
  arsipSurats   ArsipSurat[]
  berkasPimpinans BerkasPimpinan[]
  berkasSps     BerkasSp[]
  anggotas      Anggota[]
  kegiatans     Kegiatan[]
  logActivities LogActivity[]
  pengajuanPacs PengajuanPac[]
  refreshTokens RefreshToken[]
}

model Periode {
  id        String   @id @default(uuid())
  nama      String
  isActive  Boolean  @default(false)
  userId    String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User     @relation(fields: [userId], references: [id])
  arsipSurats ArsipSurat[]
  berkasPimpinans BerkasPimpinan[]
  berkasSps   BerkasSp[]
  anggotas    Anggota[]
  kegiatans   Kegiatan[]
  pengajuanPacAsal PengajuanPac[] @relation("PeriodePac")
  pengajuanPacCabang PengajuanPac[] @relation("PeriodeCabang")

  @@unique([userId, nama])
}

model BerkasSp {
  id        String   @id @default(uuid())
  namaPimpinan String
  organisasi Organisasi
  tanggalMulai DateTime
  tanggalBerakhir DateTime
  catatan   String?
  fileUrl   String?
  fileName  String?
  fileMime  String?
  fileSize  Int?
  userId    String
  periodeId String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User     @relation(fields: [userId], references: [id])
  periode   Periode? @relation(fields: [periodeId], references: [id])

  @@index([userId])
  @@index([periodeId])
}

model BerkasPimpinan {
  id        String   @id @default(uuid())
  nama      String
  tanggal   DateTime
  catatan   String?
  fileUrl   String?
  fileName  String?
  fileMime  String?
  fileSize  Int?
  userId    String
  periodeId String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User     @relation(fields: [userId], references: [id])
  periode   Periode? @relation(fields: [periodeId], references: [id])

  @@index([userId])
  @@index([periodeId])
}

model ArsipSurat {
  id        String   @id @default(uuid())
  nomorSurat String
  jenisSurat JenisSurat
  organisasi Organisasi?
  tanggalSurat DateTime
  penerimaPengirim String
  perihal String
  deskripsi String?
  fileUrl   String?
  fileName  String?
  fileMime  String?
  fileSize  Int?
  userId    String
  periodeId String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User     @relation(fields: [userId], references: [id])
  periode   Periode? @relation(fields: [periodeId], references: [id])

  @@index([userId])
  @@index([periodeId])
}

model Anggota {
  id        String   @id @default(uuid())
  namaLengkap String
  email     String?
  nik       String?
  nia       String?
  jenisKelamin String
  noHp      String?
  tempatLahir String?
  tanggalLahir DateTime?
  jabatan   String?
  rfid      String?
  hoby      String?
  alamat    String?
  foto      String?
  userId    String
  periodeId String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User     @relation(fields: [userId], references: [id])
  periode   Periode? @relation(fields: [periodeId], references: [id])

  @@index([userId])
  @@index([periodeId])
}

model Kegiatan {
  id        String   @id @default(uuid())
  judul     String
  tanggalPelaksanaan DateTime
  lokasi    String?
  waktuMulai String?
  waktuSelesai String?
  deskripsi String?
  warnaLabel String?
  userId    String
  periodeId String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User     @relation(fields: [userId], references: [id])
  periode   Periode? @relation(fields: [periodeId], references: [id])

  @@index([userId])
  @@index([periodeId])
}

model LogActivity {
  id        String   @id @default(uuid())
  action    String
  method    String
  endpoint  String
  description String?
  metadata  Json?
  userId    String
  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id])

  @@index([userId])
  @@index([createdAt])
}

model PengajuanPac {
  id            String         @id @default(uuid())
  nomorSurat    String
  penerima      Organisasi
  tanggal       DateTime
  keperluan     String
  deskripsi     String?
  status        String          @default("PENDING")
  alasanPenolakan String?
  fileUrl       String?
  fileName      String?
  fileMime      String?
  fileSize      Int?
  userId        String
  periodePacId  String
  periodeCabangId String?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt

  user          User    @relation(fields: [userId], references: [id])
  periodePac    Periode @relation("PeriodePac", fields: [periodePacId], references: [id])
  periodeCabang Periode? @relation("PeriodeCabang", fields: [periodeCabangId], references: [id])

  @@index([userId])
  @@index([periodePacId])
  @@index([periodeCabangId])
}

model RefreshToken {
  id        String   @id @default(uuid())
  tokenHash String   @unique
  revokedAt DateTime?
  expiresAt DateTime
  userId    String
  createdAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id])
}
